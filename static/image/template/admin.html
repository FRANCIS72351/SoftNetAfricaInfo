<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - {{ institute.name }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background-image: linear-gradient(180deg, rgba(15, 23, 42, 0.9), rgba(2, 6, 23, 0.85));
        }
        .panel-elevated {
            background: rgba(255, 255, 255, 0.92);
            border: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: 0 25px 45px rgba(15, 23, 42, 0.25);
            backdrop-filter: blur(18px);
        }
        .dark .panel-elevated {
            background: rgba(15, 23, 42, 0.85);
            border-color: rgba(71, 85, 105, 0.5);
        }
        .stat-card {
            position: relative;
            overflow: hidden;
        }
        .stat-card::after {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top right, rgba(59, 130, 246, 0.15), transparent 55%);
            pointer-events: none;
        }
        .action-btn {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 15px 25px rgba(59, 130, 246, 0.25);
        }
        .action-btn:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="bg-slate-100 dark:bg-slate-950">
    <nav class="bg-white dark:bg-slate-900 shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <img src="{{ institute.image_path }}" class="h-10 w-10 rounded-lg" alt="Logo">
                <h1 class="text-2xl font-bold text-blue-600">Admin Panel</h1>
            </div>
            <a href="{{ url_for('admin_logout') }}" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold">Logout</a>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-6 py-8">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="panel-elevated stat-card rounded-xl shadow p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-slate-600 dark:text-slate-400 text-sm font-semibold">Total Courses</p>
                        <p class="text-3xl font-bold text-blue-600">{{ courses|length }}</p>
                    </div>
                    <svg class="w-12 h-12 text-blue-200" fill="currentColor" viewBox="0 0 24 24"><path d="M12 6.253v13m0-13C6.228 6.253 2.5 9.475 2.5 13.25m9.5-6.997c5.772 0 9.5 3.222 9.5 7.247M12 19.5c-5.772 0-9.5-3.222-9.5-7.247m19 0V6.75l-3 2.25m0 13.25h2.25M2.5 19.5h2.25"/></svg>
                </div>
            </div>
            
            <div class="panel-elevated stat-card rounded-xl shadow p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-slate-600 dark:text-slate-400 text-sm font-semibold">New Inquiries</p>
                        <p class="text-3xl font-bold text-green-600">{{ contacts|length }}</p>
                    </div>
                    <svg class="w-12 h-12 text-green-200" fill="currentColor" viewBox="0 0 24 24"><path d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25H4.5a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5H4.5A2.25 2.25 0 002.25 6.75m19.5 0h-15m0 0H3.375c-.621 0-1.125.504-1.125 1.125v12a1.125 1.125 0 001.125 1.125h13.5a1.125 1.125 0 001.125-1.125v-12a1.125 1.125 0 00-1.125-1.125z"/></svg>
                </div>
            </div>
            
            <div class="panel-elevated stat-card rounded-xl shadow p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-slate-600 dark:text-slate-400 text-sm font-semibold">Institute</p>
                        <p class="text-lg font-bold text-purple-600">{{ institute.name }}</p>
                    </div>
                    <svg class="w-12 h-12 text-purple-200" fill="currentColor" viewBox="0 0 24 24"><path d="M12 21v-2.49a6 6 0 00-5.999-6 6 6 0 11.001-5.999H9.75m3 8.176h3m-6 0h.008v.008H9m3 0h.008v.008H12m3 0h.008v.008H15M9 9.75h6M12 12h.008v.008H12V12z"/></svg>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Courses Section -->
            <div class="lg:col-span-2">
                <div class="panel-elevated stat-card rounded-xl shadow p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold">Courses Management</h2>
                        <button onclick="openCourseModal()" class="action-btn px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition">+ Add Course</button>
                    </div>

                    <div class="space-y-4">
                        {% for course in courses %}
                        <div class="border dark:border-slate-700 rounded-lg p-4 hover:bg-slate-50 dark:hover:bg-slate-700 transition">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex-1">
                                    <h3 class="font-bold text-lg">{{ course.title }}</h3>
                                    <div class="text-sm text-slate-600 dark:text-slate-400 mt-2 space-y-1">
                                        <p><strong>Price:</strong> {{ course.price }}</p>
                                        <p><strong>Duration:</strong> {{ course.duration }}</p>
                                        <p><strong>Days:</strong> {{ course.days }}</p>
                                        <p><strong>Time:</strong> {{ course.time }}</p>
                                    </div>
                                </div>
                                <div class="flex gap-2 ml-4">
                                    <button onclick="editCourse({{ course.id }}, '{{ course.title }}', '{{ course.price }}', '{{ course.duration }}', '{{ course.days }}', '{{ course.time }}')" class="px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm font-semibold transition">Edit</button>
                                    <button onclick="deleteCourse({{ course.id }})" class="px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-sm font-semibold transition">Delete</button>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Contacts Section -->
            <div>
                <div class="panel-elevated stat-card rounded-xl shadow p-6">
                    <h2 class="text-2xl font-bold mb-6">Recent Inquiries</h2>

                    <div class="space-y-4 max-h-96 overflow-y-auto">
                        {% if contacts %}
                            {% for contact in contacts %}
                            <div class="border-l-4 border-green-500 bg-slate-50 dark:bg-slate-700 p-4 rounded">
                                <p class="font-bold text-sm">{{ contact.name }}</p>
                                <p class="text-xs text-slate-600 dark:text-slate-400">{{ contact.email }}</p>
                                <p class="text-xs text-slate-600 dark:text-slate-400">{{ contact.phone }}</p>
                                <p class="text-xs mt-2 text-slate-700 dark:text-slate-300 line-clamp-2">{{ contact.message }}</p>
                                <p class="text-xs text-slate-500 dark:text-slate-400 mt-2">{{ contact.created_at }}</p>
                            </div>
                            {% endfor %}
                        {% else %}
                        <p class="text-slate-500 text-center py-8">No inquiries yet</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Course Modal -->
    <div id="courseModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="bg-white dark:bg-slate-800 rounded-xl shadow-2xl p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold" id="modalTitle">Add New Course</h3>
                <button onclick="closeModal()" class="text-slate-600 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-100">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>

            <form id="courseForm" class="space-y-4">
                <input type="hidden" id="courseId">
                <div>
                    <label class="block text-sm font-semibold mb-2">Course Title</label>
                    <input type="text" id="courseTitle" required class="w-full px-4 py-2 border dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Price</label>
                    <input type="text" id="coursePrice" required class="w-full px-4 py-2 border dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Duration</label>
                    <input type="text" id="courseDuration" required class="w-full px-4 py-2 border dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., 10 weeks">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Days</label>
                    <input type="text" id="courseDays" required class="w-full px-4 py-2 border dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Mondays & Wednesday">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Time</label>
                    <input type="text" id="courseTime" required class="w-full px-4 py-2 border dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., 2:30 PM â€“ 4:00 PM">
                </div>
                <div class="flex gap-3 mt-6">
                    <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded-lg transition">Save Course</button>
                    <button type="button" onclick="closeModal()" class="flex-1 bg-slate-300 hover:bg-slate-400 text-slate-900 font-bold py-2 rounded-lg transition">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const modal = document.getElementById('courseModal');
        let editingId = null;

        function openCourseModal() {
            editingId = null;
            document.getElementById('modalTitle').textContent = 'Add New Course';
            document.getElementById('courseForm').reset();
            document.getElementById('courseId').value = '';
            modal.classList.remove('hidden');
        }

        function closeModal() {
            modal.classList.add('hidden');
        }

        function editCourse(id, title, price, duration, days, time) {
            editingId = id;
            document.getElementById('modalTitle').textContent = 'Edit Course';
            document.getElementById('courseId').value = id;
            document.getElementById('courseTitle').value = title;
            document.getElementById('coursePrice').value = price;
            document.getElementById('courseDuration').value = duration;
            document.getElementById('courseDays').value = days;
            document.getElementById('courseTime').value = time;
            modal.classList.remove('hidden');
        }

        document.getElementById('courseForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const courseData = {
                title: document.getElementById('courseTitle').value,
                price: document.getElementById('coursePrice').value,
                duration: document.getElementById('courseDuration').value,
                days: document.getElementById('courseDays').value,
                time: document.getElementById('courseTime').value
            };

            const url = editingId ? `/api/course/${editingId}` : '/api/course';
            const method = editingId ? 'PUT' : 'POST';

            const response = await fetch(url, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(courseData)
            });

            if (response.ok) {
                alert(editingId ? 'Course updated!' : 'Course added!');
                location.reload();
            } else {
                alert('Error saving course');
            }
        });

        async function deleteCourse(id) {
            if (!confirm('Are you sure you want to delete this course?')) return;
            
            const response = await fetch(`/api/course/${id}`, { method: 'DELETE' });
            if (response.ok) {
                alert('Course deleted!');
                location.reload();
            } else {
                alert('Error deleting course');
            }
        }

        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });
    </script>
</body>
</html>
